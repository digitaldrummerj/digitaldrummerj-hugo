<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta property="og:title" content="ASP.NET Web Api with Credentials CORS Issues Solved" />
  <meta property="og:description" content="Welcome to the continuing series on getting started with ASP.NET Web Api. At this point we have created a ASP.NET Web Api project, created our 1st controller, enabled Windows authentication, set the JSON format, and created a generic response handler. In this article we will learn how to solve in an issue that many enterprise developers have run across when called your ASP.NET Web Api with Windows Authentication client-side code such as Angular."
  />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://digitaldrummerj.me/webapi-cors-with-credentials/" />
  <meta property="article:published_time" content="2016-08-31T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2016-08-31T00:00:00&#43;00:00" />
  <meta property="og:see_also" content="http://digitaldrummerj.me/webapi-standard-response/" />
  <meta property="og:see_also" content="http://digitaldrummerj.me/webapi-json-setup/" />
  <meta property="og:see_also" content="http://digitaldrummerj.me/webapi-getting-started/" />
  <meta itemprop="name" content="ASP.NET Web Api with Credentials CORS Issues Solved">
  <meta itemprop="description" content="Welcome to the continuing series on getting started with ASP.NET Web Api. At this point we have created a ASP.NET Web Api project, created our 1st controller, enabled Windows authentication, set the JSON format, and created a generic response handler. In this article we will learn how to solve in an issue that many enterprise developers have run across when called your ASP.NET Web Api with Windows Authentication client-side code such as Angular.">
  <meta itemprop="datePublished" content="2016-08-31T00:00:00&#43;00:00" />
  <meta itemprop="dateModified" content="2016-08-31T00:00:00&#43;00:00" />
  <meta itemprop="wordCount" content="458">
  <meta itemprop="keywords" content="" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ASP.NET Web Api with Credentials CORS Issues Solved" />
  <meta name="twitter:description" content="Welcome to the continuing series on getting started with ASP.NET Web Api. At this point we have created a ASP.NET Web Api project, created our 1st controller, enabled Windows authentication, set the JSON format, and created a generic response handler. In this article we will learn how to solve in an issue that many enterprise developers have run across when called your ASP.NET Web Api with Windows Authentication client-side code such as Angular."
  />
  <meta name="msvalidate.01" content="E414777C8C1E619FC57F320448FD584A" />
  <base href="http://digitaldrummerj.me/">
  <link rel="canonical" href="http://digitaldrummerj.me/webapi-cors-with-credentials/">
  <title>Justin James</title>
  <link href="http://digitaldrummerj.me/css/app.css" rel="stylesheet">
  <script src="http://digitaldrummerj.me/js/modernizr.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Lato:400,700,400italic:latin', 'Volkhov::latin']
      }
    });
  </script> <noscript>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'>
  </noscript>
  <link href="http://digitaldrummerj.me//feed.xml" rel="alternate" type="application/rss+xml" title="Justin James" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Lato:400,700,400italic:latin', 'Volkhov::latin']
      }
    });
  </script> <noscript>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'>
</noscript> </head>

<body id="top-of-page">
  <div id="navigation" class="sticky">
    <nav class="top-bar" role="navigation" data-topbar>
      <ul class="title-area">
        <li class="name">
          <h1 class="show-for-small-only"><a href="http://digitaldrummerj.me/" class="icon-tree"> Justin James</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li>
      </ul>
      <section class="top-bar-section">
        <ul class="left">
          <li><a href="http://digitaldrummerj.me/">
                Home
              </a></li>
          <li><a href="http://digitaldrummerj.me/speaking/">Speaking Engagements</a></li>
          <li><a href="http://digitaldrummerj.me/blog/">Blog</a></li>
          <li class="has-dropdown  not-click"> <a href="/workshops/">Workshops </a>
            <ul class="dropdown">
              <li class="parent-link hide-for-large-up"> <a class="parent-link js-generated" href="/workshops/">Workshops </a> </li>
              <li> <a href="http://digitaldrummerj.me/sails-tutorial">Rapid API Development with SailsJS</a></li>
              <li> <a href="http://digitaldrummerj.me/angular-tutorial">Up and Running with Angular</a></li>
            </ul>
          </li>
        </ul>
        <ul class="right">
          <li><a href="http://digitaldrummerj.me/about/">About</a></li>
          <li><a href="http://digitaldrummerj.me/contact/">Contact</a></li>
          <li><a href="http://digitaldrummerj.me/search/">Search</a></li>
        </ul>
      </section>
    </nav>
  </div>
  <div id="masthead-no-image-header">
    <div class="row">
      <div class="small-12 columns"> <a id="logo" href="http://digitaldrummerj.me/" title="Justin James">
                <img src="/images/logo.png" alt="Justin James">
              </a> </div>
    </div>
  </div>
  <div class="row t30">
    <div class="small-12 columns medium-8">
      <header>
        <div itemprop="name">
          <h1>ASP.NET Web Api with Credentials CORS Issues Solved</h1>
        </div>
        <div id="page-meta" class="t10"> <span class="pr20"><span class="icon-calendar"></span> <time datetime="2016-08-31T00:00:00Z">
        Wed Aug 31, 2016
      </time> </span> <span class="meta-tags">
  <span class="icon-price-tag"></span> <span> 
<a href="/categories/webapi">webapi</a>/ <a href="/categories/cors">cors</a>
</span></span>
        </div>
        <p>
          <div class="series-nav">
            <p>This article is part of a series. </p>
            <ul class="side-nav">
              <li><a href="http://digitaldrummerj.me/webapi-getting-started/">Part 1 - ASP.NET Web Api - Getting Started</a></li>
              <li><a href="http://digitaldrummerj.me/webapi-json-setup/">Part 2 - ASP.NET Web Api - Setup JSON Camel Cased Fields</a></li>
              <li class="current"><span>Part 3 - This Article</span>
                <li><a href="http://digitaldrummerj.me/webapi-standard-response/">Part 4 - ASP.NET Web Api - Setup Generic Response Handler</a></li>
            </ul>
          </div>
        </p>
        <p>
          <p>Welcome to the continuing series on getting started with ASP.NET Web Api. At this point we have created a ASP.NET Web Api project, created our 1st controller, enabled Windows authentication, set the JSON format, and created a generic response
            handler. In this article we will learn how to solve in an issue that many enterprise developers have run across when called your ASP.NET Web Api with Windows Authentication client-side code such as Angular. When you try to make this access
            the endpoints for your Api from Angular when using credentials, you will get a Cross-Origin Resource Sharing (CORS) error.</p>
          <p>When you make a call to your Api from Angular, Web Api will check if the url is allowed to access the Api by using the CORS setup. However, when using credentials you can not have a wildcard for the allowed url which presents a problem when
            you are trying to make a Api for other websites to use.</p>
          <p>{% include series.html %}</p>
          <p>In order to setup CORS, we need to installed the Nuget package <code>Microsoft.AspNet.WebApi.Cors</code></p>
          <ol>
            <li>To install the nuget package, right-click on the project in Solution Explorer and select Manage Nuget Packages.</li>
            <li>Once the Nuget UI comes up, click on Browse and search for Microsoft.AspNet.WebApi.Cors</li>
            <li>Once you find the package, click on it and then click the install button</li>
          </ol>
          <p>After the package is installed, we can configure CORS in either the web.config or the App_Start\WebApiConfig.cs. Since ultimately we are making an Api that any website can call, we are going to set the CORS configuration in code instead of using
            the web.config.</p>
          <p>With in the WebApiConfig.cs to the Register method, add the following code before the routes are defined.</p>
          <pre><code>//CORS
EnableCorsAttribute cors = new EnableCorsAttribute(
    &quot;*&quot;, // Origin
    &quot;*&quot;, // Headers
    &quot;GET,POST,PUT,DELETE,OPTIONS&quot;  // HTTP Verbs
    )
{
    SupportsCredentials = true
};

config.EnableCors(cors);
</code></pre>
          <p>You also need to add the following using statement:</p>
          <pre><code>using System.Web.Http.Cors;
</code></pre>
          <p>If you were to run to code and make a call from Angular you will still get a CORS error like below since you can not have a wildard for the origin.</p>
          <p><img src="/images/BloggingOnGitHub/cors-no-origin-header.png" alt="Angular CORS Origin Header Error" /></p>
          <p>To fix this, we can add in a bit of code to the global.asax.cs in the Application_BeginRequest method to grab the url (origin) making the call and add the Request header &ldquo;Access-Control-Allow-Origin&rdquo; set to the origin url.</p>
          <p>Another very important bit of code is checking if the HttpMethod is Options and if so then returning a 200 status code and completing the request.</p>
          <p><strong>global.asax.cs</strong></p>
          <pre><code>protected void Application_BeginRequest()
{
    string origin = Request.Headers.Get(&quot;ORIGIN&quot;);
    if (origin != null)
    {
        Request.Headers.Add(&quot;Access-Control-Allow-Origin&quot;, origin);

    }

    if (Request.HttpMethod == &quot;OPTIONS&quot;)
    {
        HttpContext.Current.Response.StatusCode = 200;
        CompleteRequest();
    }
}
</code></pre>
          <p>Now if we try our Api from Angular, we are able to make the call and get data back.</p>
          <h2 id="further-reading">Further Reading</h2>
          <p><a href="http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api">http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api</a></p>
        </p>
        <p>
          <div class="series-nav">
            <p>This article is part of a series. </p>
            <ul class="side-nav">
              <li><a href="http://digitaldrummerj.me/webapi-getting-started/">Part 1 - ASP.NET Web Api - Getting Started</a></li>
              <li><a href="http://digitaldrummerj.me/webapi-json-setup/">Part 2 - ASP.NET Web Api - Setup JSON Camel Cased Fields</a></li>
              <li class="current"><span>Part 3 - This Article</span>
                <li><a href="http://digitaldrummerj.me/webapi-standard-response/">Part 4 - ASP.NET Web Api - Setup Generic Response Handler</a></li>
            </ul>
          </div>
        </p>
        <p>
          <h4>Share Post:</h4>
          <section id="sharer" class="small-12 columns social-icons">
            <ul class="inline-list">
              <li> <a class="share-twitter icon-twitter" target="_blank" href="https://twitter.com/intent/tweet?text=ASP.NET%20Web%20Api%20with%20Credentials%20CORS%20Issues%20Solved&via=digitaldrummerj" title="Tweet this"></a> </li>
              <li> <a class="share-facebook icon-facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdigitaldrummerj.me%2fwebapi-cors-with-credentials%2f" title="Share on Facebook"></a> </li>
              <li> <a class="share-email icon-mail " target="_blank" href="mailto:subject=ASP.NET%20Web%20Api%20with%20Credentials%20CORS%20Issues%20Solved&http://digitaldrummerj.me/webapi-cors-with-credentials/" title="Send ia email"></a> </li>
              <li> <a class=" share-googleplus icon-googleplus" target="_blank" href="https://plus.google.com/share?url=http%3a%2f%2fdigitaldrummerj.me%2fwebapi-cors-with-credentials%2f" title="Share on Google+"></a> </li>
              <li> <a class="share-linkedin icon-linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fdigitaldrummerj.me%2fwebapi-cors-with-credentials%2f" title="Share on LinkedIn"></a> </li>
            </ul>
          </section>
        </p>
    </div>
    <div class="hide-for-small-only medium-4 columns" data-sticky-container>
      <aside class="sidebar">
        <div class="panel radius">
          <h3>Subscribe</h3>
          <ul class="no-bullet">
            <li><span class="icon-rss"></span><a href="http://digitaldrummerj.me//feed.xml">RSS Feed</a>
              <li><span class="icon-rss"></span><a href="http://digitaldrummerj.me//atom.xml">Atom Feed</a></ul>
        </div>
        <div class="panel radius latePost">
          <h3>Recent Posts <span style="float: right"><small>(<a href="http://digitaldrummerj.me//blog/">All Posts</a>)</small></span></h3>
          <ul class="no-bullet ">
            <li><a href="/node-download-zip-and-extract/">Download and Extract Zip File with Node</a></li>
            <li><a href="/ng2-karma-not-finding-tests/">Angular 2 - No  Test Found</a></li>
            <li><a href="/ng2-add-bootstrap/">Angular 2 - Adding Bootstrap Library</a></li>
            <li><a href="/ng2-your-first-project/">Angular 2 - Your First Project</a></li>
            <li><a href="/ng2-wtf-my-module-wont-route/">Angular - WTF Module Won&rsquo;t Route</a></li>
          </ul>
        </div>
        <div class="panel radius">
          <h3>Archive</h3>
          <ul class="no-bullet">
            <li><span class="icon-archive"></span><a href="http://digitaldrummerj.me//blog/archive/monthview">By Date</a></li>
            <li><span class="icon-archive"></span><a href="http://digitaldrummerj.me//blog/archive/categoryview">By Category</a></li>
            <li><span class="icon-archive"></span><a href="http://digitaldrummerj.me//blog/archive/tagcloudview">By Tag Cloud</a></li>
          </ul>
        </div>
        <div class="panel radius">
          <h3>Categories</h3>
          <ul class="no-bullet">
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/android">Android &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/angular">Angular &nbsp;<span>(8)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/bash">Bash &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/blogging">Blogging &nbsp;<span>(19)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/book-reviews">Book Reviews &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/bower">Bower &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/c">C# &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/camtasia">Camtasia &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/chocolatey">Chocolatey &nbsp;<span>(5)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/chrome">Chrome &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/community">Community &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/cors">Cors &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/debugging">Debugging &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/docker">Docker &nbsp;<span>(3)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/git">Git &nbsp;<span>(5)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/github">Github &nbsp;<span>(5)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/gulp">Gulp &nbsp;<span>(4)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/how-to">How To &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/iis">Iis &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/ionic">Ionic &nbsp;<span>(16)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/jekyll">Jekyll &nbsp;<span>(18)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/markdown">Markdown &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/meetup">Meetup &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/node">Node &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/nodejs">Nodejs &nbsp;<span>(3)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/npm">Npm &nbsp;<span>(4)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/nuget">Nuget &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/powershell">Powershell &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/productivity">Productivity &nbsp;<span>(5)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/programming">Programming &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/proxy">Proxy &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/speaking">Speaking &nbsp;<span>(4)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/strongloop">Strongloop &nbsp;<span>(1)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/vagrant">Vagrant &nbsp;<span>(9)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/virtualbox">Virtualbox &nbsp;<span>(6)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/visual-studio">Visual Studio &nbsp;<span>(6)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/web-api">Web Api &nbsp;<span>(3)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/webapi">Webapi &nbsp;<span>(2)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/windows">Windows &nbsp;<span>(4)</span></a></li>
            <li><span class="icon-price-tag"></span><a href="http://digitaldrummerj.me/categories/year-in-review">Year in Review &nbsp;<span>(1)</span></a></li>
          </ul>
        </div>
      </aside>
    </div>
  </div>
  </div>
  <footer id="footer-content" class="bg-grau">
    <div id="footer">
      <div class="row">
        <div class="medium-6 columns">
          <h5 class="shadow-black">About This Site</h5>
          <p class="shadow-black"> Sharing my knowledge with others in a manner that is easy to understand and consume. <a href="/about/">More ›</a></p>
        </div>
        <div class="small-12 medium-6 columns">
          <h5 class="shadow-black">Services</h5>
          <ul class="no-bullet shadow-black">
            <li> <a href="" title=""></a></li>
            <li class="icon-mail"> <a href="/contact/" title="Contact">Contact</a></li>
            <li class="icon-rss"> <a href="/feed.xml" type="application/rss+xml" title="Subscribe to RSS Feed">RSS</a></li>
            <li class="icon-rss"><a href="/atom.xml" type="application/rss+xml" title="Subscribe to Atom Feed">Atom</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div id="subfooter">
      <nav class="row">
        <section id="subfooter-left" class="small-12 medium-6 columns credits">
          <p>Created with ♥ by <a href="/about/">Justin James</a>. All content is the property of Justin James and digitaldrummerj.me. This blog, its content, and opinions are my own.</p>
        </section>
        <section id="subfooter-right" class="small-12 medium-6 columns social-icons">
          <ul class="inline-list">
            <li><a href="https://github.com/digitaldrummerj" target="_blank" class="icon-github" title="Code and such..."></a></li>
            <li><a href="https://www.youtube.com/channel/UCDMvOL1XSKclxwplUT0fzLA" target="_blank" class="icon-youtube" title="Tech Videos"></a></li>
            <li><a href="https://twitter.com/digitaldrummerj" target="_blank" class="icon-twitter" title="Twitter"></a></li>
          </ul>
        </section>
      </nav>
    </div>
  </footer>
  <foot>
    <script src="http://digitaldrummerj.me/js/jquery-3.1.1.min.js"></script>
    <script src="http://digitaldrummerj.me/js/javascript.min.js"></script>
    <script src="http://digitaldrummerj.me/js/app.js"></script>
  </foot>
</body>

</html>